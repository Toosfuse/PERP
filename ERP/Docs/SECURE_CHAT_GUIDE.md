# ๐ ุฑุงูููุง ุณุณุชู ฺุช ุงูู - ุฌุฏุงุณุงุฒ ูููุงู ู ฺฉุงุฑููุฏ

## โ ุชุบุฑุงุช ุงุนูุงู ุดุฏู

### 1. **ChatHub.cs** - ฺุช ุฏุงุฎู ฺฉุงุฑููุฏุงู
- โ ุญุฐู `Clients.All` 
- โ ุงุณุชูุงุฏู ุงุฒ `Clients.Group("User_{userId}")`
- โ ุจุฑุฑุณ ุฏุณุชุฑุณ ูุจู ุงุฒ ูุฑ ุงุฑุณุงู ูพุงู
- โ ุงุทูุงุนุฑุณุงู ููุท ุจู ฺฉุงุฑุจุฑุงู ูุฌุงุฒ

### 2. **GuestChatHub.cs** - ฺุช ูููุงู (ุฌุฏุฏ)
- โ Hub ฺฉุงููุงู ุฌุฏุงฺฏุงูู ุจุฑุง ูููุงููุง
- โ ูููุงู ููุท ุจุง ฺฉุงุฑููุฏ ูุณุฆูู ุฎูุฏ ุงุฑุชุจุงุท ุฏุงุฑุฏ
- โ ุจุฑุฑุณ ExpiryDate ู IsActive
- โ ุฌููฺฏุฑ ุงุฒ ุงุฑุชุจุงุท ูููุงู ุจุง ูููุงู

---

## ๐ ูุนูุงุฑ ุงููุช

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    SignalR Hubs                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  ChatHub (/chatHub)          GuestChatHub (/guestChatHub)โ
โ  โโ ฺฉุงุฑููุฏ A                โโ ูููุงู 1                 โ
โ  โโ ฺฉุงุฑููุฏ B                โโ ูููุงู 2                 โ
โ  โโ ฺฉุงุฑููุฏ C                โโ ูููุงู 3                 โ
โ                                                         โ
โ  Groups:                     Groups:                    โ
โ  โข User_EmployeeId           โข Guest_GuestId           โ
โ  โข Employees                 โข User_EmployeeId (ุจุฑุง ฺฉุงุฑููุฏ)โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ููุงูู ุฏุณุชุฑุณ

### ฺฉุงุฑููุฏ ุจู ฺฉุงุฑููุฏ:
```csharp
// ุจุฑุฑุณ ุฏุฑ ChatAccess
if (ChatAccess.UserId == SenderId && 
    ChatAccess.AllowedUserId == ReceiverId && 
    !ChatAccess.IsBlocked)
{
    // ุงุฑุณุงู ูุฌุงุฒ
}
```

### ูููุงู ุจู ฺฉุงุฑููุฏ:
```csharp
// ุจุฑุฑุณ ุฏุฑ GuestChatAccess
if (GuestChatAccess.GuestUserId == SenderId && 
    GuestChatAccess.AllowedUserId == ReceiverId &&
    GuestUser.IsActive &&
    GuestUser.ExpiryDate > DateTime.Now)
{
    // ุงุฑุณุงู ูุฌุงุฒ
}
```

### โ ูููุงู ุจู ูููุงู:
```
REJECTED - ูฺ ูููุงู ููุชูุงูุฏ ุจุง ูููุงู ุฏฺฏุฑ ฺุช ฺฉูุฏ
```

---

## ๐ฏ ูุญูู ุงุณุชูุงุฏู ุฏุฑ JavaScript

### ุจุฑุง ฺฉุงุฑููุฏุงู (ฺุช ุฏุงุฎู):
```javascript
// ุงุชุตุงู ุจู ChatHub
const connection = new signalR.HubConnectionBuilder()
    .withUrl("/chatHub")
    .build();

// ุงุฑุณุงู ูพุงู
connection.invoke("SendMessage", receiverId, message);

// ุฏุฑุงูุช ูพุงู
connection.on("ReceiveMessage", (data) => {
    console.log("ูพุงู ุงุฒ:", data.senderId);
    console.log("ูุชู:", data.message);
});
```

### ุจุฑุง ูููุงููุง:
```javascript
// ุงุชุตุงู ุจู GuestChatHub
const guestConnection = new signalR.HubConnectionBuilder()
    .withUrl("/guestChatHub")
    .build();

// ุงุฑุณุงู ูพุงู ุจู ฺฉุงุฑููุฏ
guestConnection.invoke("SendMessageToEmployee", message);

// ุฏุฑุงูุช ูพุงู ุงุฒ ฺฉุงุฑููุฏ
guestConnection.on("ReceiveEmployeeMessage", (data) => {
    console.log("ูพุงู ุงุฒ ฺฉุงุฑููุฏ:", data.message);
});
```

### ุจุฑุง ฺฉุงุฑููุฏ (ูพุงุณุฎ ุจู ูููุงู):
```javascript
// ุฏุฑ ููุงู ChatHub
connection.invoke("SendMessageToGuest", guestUserId, message);

// ุฏุฑุงูุช ูพุงู ุงุฒ ูููุงู
connection.on("ReceiveGuestMessage", (data) => {
    console.log("ูพุงู ุงุฒ ูููุงู:", data.guestName);
    console.log("ูุชู:", data.message);
});
```

---

## ๐ก๏ธ ฺฺฉูุณุช ุงููุช

โ **ุงูุฌุงู ุดุฏู:**
- [x] ุญุฐู Clients.All ุงุฒ ุชูุงู ูุชุฏูุง
- [x] ุงุณุชูุงุฏู ุงุฒ Groups ุจุง ูุงูฺฏุฐุงุฑ ููุญุตุฑ ุจู ูุฑุฏ
- [x] ุจุฑุฑุณ ุฏุณุชุฑุณ ุฏุฑ ูุฑ ูุชุฏ
- [x] ุฌุฏุงุณุงุฒ ฺฉุงูู Hub ูููุงู ู ฺฉุงุฑููุฏ
- [x] ุจุฑุฑุณ IsActive ู ExpiryDate ุจุฑุง ูููุงููุง
- [x] ูุงฺฏ ุชูุงู ูพุงููุง ุฏุฑ ุฏุชุงุจุณ

โ๏ธ **ุชูุตููุง ุงุถุงู:**
- [ ] ุงุถุงูู ฺฉุฑุฏู Rate Limiting ุจุฑุง ูููุงููุง
- [ ] ูพุงุฏูุณุงุฒ Audit Log ุจุฑุง ูุงูุชูุฑูฺฏ
- [ ] ุงุถุงูู ฺฉุฑุฏู ููุชุฑ ูุญุชูุง (Spam Detection)
- [ ] ูุญุฏูุฏุช ุญุฌู ูพุงู ุจุฑุง ูููุงููุง
- [ ] Timeout ุฎูุฏฺฉุงุฑ ุจุฑุง session ูููุงู

---

## ๐ ูุงูุชูุฑูฺฏ

### ุจุฑุง ูุดุงูุฏู ุชูุงู ูฺฉุงููุงุช ุฏุฑ ูพูู ูุงูุชูุฑูฺฏ:

```csharp
// ุฏุฑ ChatHub - ุงุถุงูู ฺฉุฑุฏู ูุงุธุฑ ุจู ฺฏุฑูู
public async Task JoinMonitoring()
{
    var userId = GetUserId();
    var isAdmin = // ุจุฑุฑุณ ููุด ุงุฏูู
    
    if (isAdmin)
    {
        await Groups.AddToGroupAsync(Context.ConnectionId, "Monitoring");
    }
}

// ุงุฑุณุงู ููุฒูุงู ุจู ูุงุธุฑุงู
await Clients.Group("Monitoring").SendAsync("MonitorMessage", messageData);
```

---

## ๐จ ุฎุทุงูุง ุฑุงุฌ ู ุฑุงูุญู

### ุฎุทุง: ูููุงู ูพุงู ฺฉุงุฑููุฏุงู ุฑุง ูุจูุฏ
**ุนูุช:** ุงุณุชูุงุฏู ุงุฒ Clients.All  
**ุฑุงูุญู:** โ ุงุตูุงุญ ุดุฏู - ุงุณุชูุงุฏู ุงุฒ Groups

### ุฎุทุง: ฺฉุงุฑููุฏ ููุชูุงูุฏ ุจู ูููุงู ูพุงุณุฎ ุฏูุฏ
**ุนูุช:** ุนุฏู ุงุชุตุงู ุจู GuestChatHub  
**ุฑุงูุญู:** ฺฉุงุฑููุฏ ุจุงุฏ ุงุฒ ูุชุฏ SendMessageToGuest ุฏุฑ ChatHub ุงุณุชูุงุฏู ฺฉูุฏ

### ุฎุทุง: ูพุงู ุงุฑุณุงู ููุดูุฏ
**ุจุฑุฑุณ:**
1. ุขุง ChatAccess ุง GuestChatAccess ูุฌูุฏ ุฏุงุฑุฏุ
2. ุขุง IsBlocked = false ุงุณุชุ
3. ุขุง ูููุงู IsActive = true ุฏุงุฑุฏุ
4. ุขุง ExpiryDate ฺฏุฐุดุชู ูุณุชุ

---

## ๐ ูุซุงู ฺฉุงูู - ุณูุงุฑู ูุงูุน

```
1. ูููุงู ูุงุฑุฏ ุณุงุช ูุดูุฏ
   โ ุงุชุตุงู ุจู /guestChatHub
   โ ุงุถุงูู ุดุฏู ุจู Group("Guest_123")

2. ุณุณุชู ฺฉุงุฑููุฏ ูุณุฆูู ุฑุง ุชุนู ูฺฉูุฏ
   โ ุงุฌุงุฏ ุฑฺฉูุฑุฏ ุฏุฑ GuestChatAccess
   โ GuestUserId = 123, AllowedUserId = "Emp456"

3. ูููุงู ูพุงู ููุฑุณุชุฏ
   โ SendMessageToEmployee("ุณูุงู")
   โ ุงุฑุณุงู ููุท ุจู Group("User_Emp456")
   โ ฺฉุงุฑููุฏ Emp456 ูพุงู ุฑุง ูุจูุฏ

4. ฺฉุงุฑููุฏ ูพุงุณุฎ ูุฏูุฏ
   โ SendMessageToGuest(123, "ุณูุงูุ ฺุทูุฑ ูุชููู ฺฉูฺฉุชูู ฺฉููุ")
   โ ุงุฑุณุงู ููุท ุจู Group("Guest_123")
   โ ููุท ูููุงู 123 ูพุงู ุฑุง ูุจูุฏ

5. ฺฉุงุฑููุฏ A ุจุง ฺฉุงุฑููุฏ B ฺุช ูฺฉูุฏ
   โ SendMessage("EmpB", "ุณูุงู")
   โ ุงุฑุณุงู ููุท ุจู Group("User_EmpB")
   โ ูฺ ูููุงู ุงู ูพุงู ุฑุง ููุจูุฏ โ
```

---

## ๐ง ุชุณุช ุงููุช

### ุชุณุช 1: ุฌุฏุงุณุงุฒ ูููุงู
```javascript
// ูููุงู 1 ูุชุตู ุงุณุช
// ฺฉุงุฑููุฏ A ุจุง ฺฉุงุฑููุฏ B ฺุช ูฺฉูุฏ
// ุงูุชุธุงุฑ: ูููุงู 1 ูฺ ูพุงู ูุจูุฏ โ
```

### ุชุณุช 2: ุฏุณุชุฑุณ ูุญุฏูุฏ
```javascript
// ูููุงู 1 ุจู ฺฉุงุฑููุฏ A ุงุฎุชุตุงุต ุฏุงุฑุฏ
// ูููุงู 1 ุณุน ูฺฉูุฏ ุจู ฺฉุงุฑููุฏ B ูพุงู ุจูุฑุณุชุฏ
// ุงูุชุธุงุฑ: REJECTED โ
```

### ุชุณุช 3: ุงููุถุง session
```javascript
// ูููุงู 1 ุจุง ExpiryDate ฺฏุฐุดุชู
// ุณุน ุฏุฑ ุงุฑุณุงู ูพุงู
// ุงูุชุธุงุฑ: REJECTED โ
```

---

**ุชุงุฑุฎ ุจูุฑูุฒุฑุณุงู:** 2025  
**ูุณุฎู:** 2.0 - Secure Edition
