@using ERP.ViewModels.SMT
@using Kendo.Mvc.UI
@using System.Globalization
@{
    ViewData["Title"] = "Ù„ÛŒØ³Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø§Ù†ÙˆÛŒÙ‡ SMT";
    Layout = "_Layout";
}

<link href="~/fonts/fontawesome-free-7.1.0-web/css/all.min.css" rel="stylesheet" />

<style>
    body { background-color: #f8f9fa; }
    .card { border: none; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .card-header { border-radius: 12px 12px 0 0; border: none; }
    .gradient-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .badge-count { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 8px 12px; border-radius: 6px; }
    .btn-view { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; padding: 6px 12px; border-radius: 6px; }
    .btn-view:hover { background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); color: white; }
</style>

<div class="container-fluid mt-4" dir="rtl">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card gradient-header">
                <div class="card-body text-center py-5">
                    <h1 class="mb-2"><i class="fas fa-chart-bar me-3"></i>Ù„ÛŒØ³Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø§Ù†ÙˆÛŒÙ‡ SMT</h1>
                    <p class="mb-0">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø§Ù†ÙˆÛŒÙ‡ Ø«Ø¨Øª Ø´Ø¯Ù‡</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid Ù„ÛŒØ³Øª ØªØ§Ø±ÛŒØ®Ù‡Ø§ -->
    <div class="card">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-calendar me-2 text-primary"></i>Ù„ÛŒØ³Øª ØªØ§Ø±ÛŒØ®Ù‡Ø§</h5>
        </div>
        <div class="card-body p-0">
            <div class="k-rtl" style="overflow-x:auto;width:100%;">
                @(
                                Html.Kendo().Grid<SMTSecondaryListViewModel>()
                        .Name("gridSecondaryList")
                        .Columns(columns =>
                        {
                                    columns.Bound(c => c.SecondaryDatePersian).Title("ðŸ“… ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ").Width(120);
                                    columns.Bound(c => c.count).Title("ðŸ“Š ØªØ¹Ø¯Ø§Ø¯").Width(120);
                            
                            columns.Command(command =>
                            {
                                command.Custom("view")
                                    .Text("<i class='fas fa-eye'></i> Ù†Ù…Ø§ÛŒØ´")
                                    .Click("viewDetails")
                                    .HtmlAttributes(new { @class = "btn btn-view btn-sm" });
                            }).Title("âš™ï¸ Ø¹Ù…Ù„ÛŒØ§Øª").Width(130);
                        })
                        .Pageable(p => p
                            .PageSizes(new[] { 10, 20, 50 })
                            .Refresh(true)
                            .ButtonCount(5)
                            .Messages(m => m
                                .Display("Ù†Ù…Ø§ÛŒØ´ {0} - {1} Ø§Ø² {2}")
                                .Empty("Ù‡ÛŒÚ† Ø±Ú©ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯")))
                        .Sortable()
                        .Filterable()
                        .Scrollable(s => s.Height("auto"))
                        .Resizable(r => r.Columns(true))
                        .DataSource(ds => ds
                            .Ajax()
                            .PageSize(20)
                            .ServerOperation(true)
                            .Read(read => read
                                .Action("SMTSecondaryList_Read", "SMT"))
                        )
                )
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        

        function viewDetails(e) {
            e.preventDefault();
            const tr = $(e.currentTarget).closest("tr");
            const dataItem = $("#gridSecondaryList").data("kendoGrid").dataItem(tr);
            
            window.location.href = '@Url.Action("SecondaryListDetails", "SMT")?date=' + encodeURIComponent(dataItem.SecondaryDatePersian);
        }
    </script>
}
