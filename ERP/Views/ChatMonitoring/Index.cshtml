@{
    ViewData["Title"] = "مانیتورینگ چت";

}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/CSS/chat-monitoring.css">

    <link href="~/fonts/fontawesome-free-7.1.0-web/css/all.min.css" rel="stylesheet" />
 
    <link href="~/jalalidatepicker/jalalidatepicker.css" rel="stylesheet" />
</head>
<body>
    <div class="monitoring-container">
        <div class="monitoring-header">
            <div class="header-left">
                <i class="fa fa-eye header-icon"></i>
                <div>
                    <h1>مانیتورینگ چت سازمانی</h1>
                    <p>نظارت بر تمام مکالمات کاربران</p>
                </div>
            </div>
            <div class="header-actions">
                <button id="refreshBtn" class="btn-action" title="بروزرسانی">
                    <i class="fa fa-refresh"></i>
                </button>
                <a href="/Home/Cartable" class="btn-back">
                    <i class="fa fa-arrow-left"></i>
                    بازگشت
                </a>
            </div>
        </div>

        <div class="stats-bar ">
            <div class="stat-card">
                <i class="fa fa-comments"></i>
                <div>
                    <span class="stat-value" id="totalMessages">0</span>
                    <span class="stat-label">کل پیامها</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fa fa-user"></i>
                <div>
                    <span class="stat-value" id="activeConversations">0</span>
                    <span class="stat-label">مکالمات فعال</span>
                </div>
            </div>

            <div class="stat-card">
                <i class="fa fa-users"></i>
                <div>
                    <span class="stat-value" id="totalGroups">0</span>
                    <span class="stat-label">تعداد گروهها</span>
                </div>
            </div>

            <div class="stat-card">
                <i class="fa fa-clock"></i>
                <div>
                    <span class="stat-value" id="messagesLast24h">0</span>
                    <span class="stat-label">24 ساعت گذشته</span>
                </div>
            </div>
            <div class="stat-card">
                <i class="fa fa-user"></i>
                <div>
                    <span class="stat-value" id="totalUsers">0</span>
                    <span class="stat-label">کل کاربران</span>
                </div>
            </div>
        </div>

        <div class="filter-bar " style="margin-bottom:5px">
            <div class="filter-group">
                <label><i class="fa fa-calendar"></i> از تاریخ:</label>
                <input type="text" name="RegDatePersian" id="fromDate"
                       class="form-control form-control-lg input-ltr shadow-sm"
                      
                       value="@ViewBag.RegDatePersian"
                       maxlength="10" required data-jdp />
              
            </div>
            <div class="filter-group">
                <label><i class="fa fa-calendar"></i> تا تاریخ:</label>
                <input type="text" name="RegDatePersian" id="toDate"
                       class="form-control form-control-lg input-ltr shadow-sm"
                      
                       value="@ViewBag.RegDatePersian"
                       maxlength="10" required data-jdp />
             
            </div>
            <div class="filter-group">
                <label><i class="fa fa-users"></i> گروه:</label>
                <select id="groupFilter">
                    <option value="">همه گروه‌ها</option>
                </select>
            </div>
            <div class="filter-group">
                <label><i class="fa fa-circle"></i> وضعیت:</label>
                <select id="onlineStatus">
                    <option value="">همه</option>
                    <option value="online">آنلاین</option>
                    <option value="offline">آفلاین</option>
                </select>
            </div>
            <div class="filter-group">
                <label><i class="fa fa-eye"></i> پیام:</label>
                <select id="readStatus">
                    <option value="">همه</option>
                    <option value="read">خوانده شده</option>
                    <option value="unread">خوانده نشده</option>
                </select>
            </div>
            <button id="applyFilters" class="btn-filter"><i class="fa fa-filter"></i> اعمال فیلتر</button>
            <button id="clearFilters" class="btn-clear"><i class="fa fa-times"></i> پاک کردن</button>
        </div>

        <div class="monitoring-content">
            <div class="conversations-panel">
                <div class="panel-header">
                    <h3><i class="fa fa-list"></i> مکالمات</h3>
                    <div class="search-box">
                        <i class="fa fa-search"></i>
                        <input type="text" id="searchConversations" placeholder="جستجوی کاربر..." />
                    </div>
                </div>
                <div class="conversations-list" id="conversationsList">
                    <div class="loading">
                        <i class="fa fa-spinner fa-spin"></i>
                        <p>در حال بارگذاری...</p>
                    </div>
                </div>
            </div>

            <div class="messages-panel">
                <div class="panel-header">
                    <div class="conversation-info">
                        <h3 id="conversationTitle">مکالمه را انتخاب کنید</h3>
                        <p id="conversationSubtitle"></p>
                    </div>
                    <div class="message-search">
                        <i class="fa fa-search"></i>
                        <input type="text" id="searchMessages" placeholder="جستجو در پیامها..." />
                    </div>
                </div>
                <div class="messages-list" id="messagesList">
                    <div class="empty-state">
                        <i class="fa fa-comments-o"></i>
                        <p>یک مکالمه را از سمت راست انتخاب کنید</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="groupMembersModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:500px;">
            <div class="modal-header" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;padding:15px;border-radius:12px 12px 0 0;">
                <h3 style="margin:0;display:flex;align-items:center;gap:10px;"><i class="fa fa-users"></i> اعضای گروه</h3>
                <div style="display:flex;gap:10px;align-items:center;">
                    <button id="showHistoryBtn" style="background:rgba(255,255,255,0.2);border:none;color:white;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:12px;transition:all 0.3s;"><i class="fa fa-history"></i> تاریخچه</button>
                    <button class="close-modal" style="background:none;border:none;color:white;font-size:24px;cursor:pointer;">&times;</button>
                </div>
            </div>
            <div class="modal-body" id="groupMembersContent" style="padding:20px;max-height:400px;overflow-y:auto;">
                <div class="loading"><i class="fa fa-spinner fa-spin"></i><p>در حال بارگذاری...</p></div>
            </div>
        </div>
    </div>
    @section Scripts {
    <script src="~/JS/jquery-3.6.0.min.js"></script>
    <script src="~/SignalR/signalr.min.js"></script>
    <script src="~/jalalidatepicker/jalalidatepicker.min.js"></script>
    <script src="~/JS/chat-monitoring.js"></script>
    <script>
        jalaliDatepicker.startWatch();
    </script>
    }
    <style>
        .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:1000; }
        .modal-content { background:white; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.3); width:90%; animation:slideDown 0.3s; }
        .modal-header { display:flex; justify-content:space-between; align-items:center; }
        .close-modal:hover { opacity:0.8; }
        @@keyframes slideDown { from { transform:translateY(-50px); opacity:0; } to { transform:translateY(0); opacity:1; } }
        .member-item { display:flex; align-items:center; gap:12px; padding:12px; background:#f7fafc; border-radius:8px; margin-bottom:8px; transition:all 0.3s; }
        .member-item:hover { background:#edf2f7; transform:translateX(5px); }
        .member-avatar { width:45px; height:45px; border-radius:50%; object-fit:cover; border:2px solid #667eea; }
        .member-info { flex:1; }
        .member-name { font-weight:600; color:#2d3748; font-size:14px; }
        .member-status { font-size:12px; color:#718096; margin-top:2px; }
        .admin-badge { background:linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color:white; padding:3px 8px; border-radius:10px; font-size:11px; font-weight:600; }
        .left-badge { background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color:white; padding:3px 8px; border-radius:10px; font-size:11px; font-weight:600; }
        .online-dot { width:10px; height:10px; border-radius:50%; background:#48bb78; display:inline-block; margin-left:5px; }
        .offline-dot { width:10px; height:10px; border-radius:50%; background:#cbd5e0; display:inline-block; margin-left:5px; }
        #showHistoryBtn:hover { background:rgba(255,255,255,0.3); }
    </style>
</body>
</html>
