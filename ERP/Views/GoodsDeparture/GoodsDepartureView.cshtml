@using Kendo.Mvc.UI
@using System.Security.Claims
@model ERP.Models.GoodsDeparture

@{
    var guid = ViewBag.Guid;
    var workflowInstance = ViewBag.WorkflowInstance as ERP.Models.WorkflowInstance;
    var currentState = Model?.State ?? "start0";
    var canEdit = ViewBag.CanEdit ?? false;
    var isObserver = ViewBag.IsObserver ?? false;
    var isSuccessfulCompletion = ViewBag.IsSuccessfulCompletion ?? false;
    var endReason = ViewBag.EndReason ?? "";
    var workflowSteps = ViewBag.WorkflowSteps as List<ERP.Models.WorkflowStep>;

    var completedSections = new List<string>();
    if (workflowInstance != null)
    {
        var history = ViewBag.WorkflowHistory as List<ERP.Models.WorkflowInstance>;
        if (history != null)
        {
            completedSections = history
                .Where(w => w.IsCompleted)
                .OrderBy(w => w.AssignedDate)
                .Select(w => w.Section)
                .Distinct()
                .ToList();
        }
    }
    else if (currentState == "start0")
    {
        completedSections.Add("start0");
    }
}
<div class="app-title">
    <div>
        <h1><i class="fa fa-inbox" style="margin-left:10px;color:red"></i><span>خروج کالا</span><span class="id-card">@Model.GoodsDepartureID</span> </h1>
    </div>
    <ul class="app-breadcrumb breadcrumb"></ul>
</div>

<input type="hidden" asp-for="GoodsDepartureID" />
<input type="hidden" value="@guid" name="Guid" id="Guid" />


<div class="row justify-content-center align-items-center">
    <div class="col-md-9">
        <div class="tile">
            @foreach (var step in workflowSteps)
            {
                var sectionCode = step.SectionCode;
                var sectionName = step.SectionName;
                var isSectionCompleted = completedSections.Contains(sectionCode);
                var isCurrentSection = currentState == sectionCode;
                var isEditable = canEdit && isCurrentSection;

                @if ((isSectionCompleted && (canEdit || isObserver)) || (isCurrentSection && canEdit))
                {
                    <div class="card shadow-sm" id="section_@sectionCode" @(isEditable ? "" : "style='pointer-events: none; opacity: 0.7;'")>
                        <div class="card-header @(sectionCode == "start0" ? "bg-primary" : "bg-secondary") text-white text-center">
                            <h5 class="mb-0">@sectionName</h5>
                        </div>
                        <form id="form_@sectionCode" novalidate>
                            <div class="card-body">
                                @if (sectionCode == "start0")
                                {
                                    <div class="form-row">
                                        <div class="form-group col-md-3">
                                            <label asp-for="S_persiandate" class="font-weight-bold">تاریخ درخواست</label>
                                            <input asp-for="S_persiandate" class="form-control" data-jdp disabled autocomplete="off" />
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label asp-for="Shomareh_Anabr" class="font-weight-bold">شماره انبار</label>
                                            <input asp-for="Shomareh_Anabr" class="form-control" data-parsley-required="true" data-parsley-required-message="فیلد خالی است" disabled="@(!isEditable)" autocomplete="off" />
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label asp-for="Name_Anbar" class="font-weight-bold">نام انبار</label>
                                            <input asp-for="Name_Anbar" class="form-control" data-parsley-required="true" data-parsley-required-message="فیلد خالی است" disabled="@(!isEditable)" autocomplete="off" />
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label asp-for="Shomareh_havale" class="font-weight-bold">شماره حواله</label>
                                            <input asp-for="Shomareh_havale" class="form-control" data-parsley-required="true" data-parsley-required-message="فیلد خالی است" disabled="@(!isEditable)" autocomplete="off" />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-4">
                                            <label asp-for="Date_persiandate" class="font-weight-bold">تاریخ حواله</label>
                                            <input asp-for="Date_persiandate" class="form-control" data-jdp data-parsley-required="true" data-parsley-required-message="فیلد خالی است" disabled="@(!isEditable)" autocomplete="off" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label asp-for="Code_TahvilGirandeh" class="font-weight-bold">کد تحویل گیرنده</label>
                                            <input asp-for="Code_TahvilGirandeh" class="form-control" data-parsley-required="true" data-parsley-required-message="فیلد خالی است" disabled="@(!isEditable)" autocomplete="off" />
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label asp-for="Nam_TahvilGirandeh" class="font-weight-bold">نام تحویل گیرنده</label>
                                            <input asp-for="Nam_TahvilGirandeh" class="form-control" data-parsley-required="true" data-parsley-required-message="فیلد خالی است" disabled="@(!isEditable)" autocomplete="off" />
                                        </div>
                                      
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-12">
                                            <label class="font-weight-bold">فایل</label>
                                            @if (isEditable)
                                            {
                                                <div class="k-rtl">
                                                    @(Html.Kendo().Upload()
                                                                                        .Name("files")
                                                                                        .HtmlAttributes(new { aria_label = "files" })
                                                                                        .Multiple(false)
                                                                                        .Async(a => a
                                                                                        .Save("Async_Save", "FileUpload")
                                                                                        .Remove("Async_Remove", "FileUpload")
                                                                                        .AutoUpload(true)
                                                                                        )
                                                                                        .Validation(validation => validation
                                                                                        .MaxFileSize(50000000)
                                                                                        .AllowedExtensions(new string[] { ".jpg", ".png", ".pdf", ".docx", ".xlsx" })
                                                                                        )
                                                                                        .Events(events => events
                                                                                        .Upload("onUpload")
                                                                                        .Remove("onRemove")
                                                                                        )
                                                                                        )
                                            </div>
                                                                }
                                            else if (Model?.GoodsDepartureID > 0)
                                            {
                                                <div class="form-group col-md-6">
                                                    <table class="table table-bordered HideTable" id="ali">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">نام فایل‌ها</th>
                                                                <th scope="col">عملیات</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="tableFile"></tbody>
                                                    </table>
                                                </div>
                                                <script>
                                                    $(document).ready(function () {
                                                        var GoodsDepartureID = $('#GoodsDepartureID').val();
                                                        $.ajax({
                                                            type: "POST",
                                                            url: "/GoodsDeparture/DownloadFile",
                                                            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                                                            data: { id: GoodsDepartureID },
                                                            success: function (r) {
                                                                $('#tableFile').empty();
                                                                if (r.status === 'OK' && r.data.length > 0) {
                                                                    for (var i = 0; i < r.data.length; i++) {
                                                                        var markup = "<tr><td scope='col'>" + r.data[i].Name + r.data[i].Extension + "</td><td scope='col'><a class='fa fa-download asd' href='/FileUpload/DownloadFileDatabase/" + r.data[i].FileID + "'></a></td></tr>";
                                                                        $("#tableFile").append(markup);
                                                                    }
                                                                    $("#ali").removeClass("HideTable").addClass("ShowTable");
                                                                } else {
                                                                    $("#ali").removeClass("ShowTable").addClass("HideTable");
                                                                }
                                                            },
                                                            error: function (response) {
                                                                alert('خطا در ارتباط با سرور: ' + response.responseText);
                                                            }
                                                        });
                                                    });
                                                </script>
                                            }
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-12">
                                            <label asp-for="Tozihat" class="font-weight-bold">توضیحات</label>
                                            <textarea asp-for="Tozihat" class="form-control" rows="5" disabled="@(!isEditable)"></textarea>
                                        </div>
                                    </div>
                                    @if (currentState == "start0" && canEdit)
                                    {
                                        <div class="row justify-content-center">
                                            <div class="form-group col-md-6">
                                                <label class="control-label">انتخاب فرد تایید کننده</label>
                                                <select class="form-control select2" id="FinanceUserID" name="FinanceUserID" data-parsley-required="true" data-parsley-required-message="لطفاً فرد تایید کننده در واحد مالی را انتخاب کنید">
                                                    <option value="">لطفاً فرد تایید کننده را انتخاب کنید</option>
                                                </select>
                                                <span class="text-danger" data-parsley-errors-container="#financeUserIDError"></span>
                                            </div>
                                        </div>
                                    }
                                }
                                @if (sectionCode == "TayidMali1")
                                {
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label class="font-weight-bold">مورد تأیید است؟</label><br>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input sq" type="radio" asp-for="Taeed" value="0" disabled="@(!isEditable)">
                                                <label class="form-check-label sq">بله</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input sq" type="radio" asp-for="Taeed" value="1" disabled="@(!isEditable)">
                                                <label class="form-check-label sq">خیر</label>
                                            </div>
                                            <span id="taeedError" class="text-danger"></span>
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label asp-for="Tozihat_Mali" class="font-weight-bold">توضیحات امور مالی</label>
                                            <textarea asp-for="Tozihat_Mali" class="form-control" rows="5" disabled="@(!isEditable)"></textarea>
                                        </div>
                                    </div>
                                }
                                @if (sectionCode == "Negahbani2")
                                {
                                    <div class="form-row">
                                        <div class="form-group col-md-3">
                                            <label asp-for="IsBazrasi" class="font-weight-bold">بازرسی انجام شد</label><br>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input sq" type="radio" asp-for="IsBazrasi" value="0" disabled="@(!isEditable)">
                                                <label class="form-check-label sq">بله</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input sq" type="radio" asp-for="IsBazrasi" value="1" disabled="@(!isEditable)">
                                                <label class="form-check-label sq">خیر</label>
                                            </div>
                                            <span id="isBazrasiError" class="text-danger"></span>
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label asp-for="Noe_Hamel" class="font-weight-bold">نوع حامل</label>
                                            <select asp-for="Noe_Hamel" data-parsley-required="true" data-parsley-required-message="نوع حامل را مشخص نمایید" class="form-control" disabled="@(!isEditable)">
                                                <option value="">انتخاب کنید</option>
                                                <option value="0">شخص</option>
                                                <option value="1">خودرو شرکتی</option>
                                                <option value="2">خودرو غیر شرکتی</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="col-md-12">
                                            <label class="font-weight-bold">ثبت خروج خودرو</label>
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-hover" id="vehicleExitsTable">
                                                    <thead class="thead-light">
                                                        <tr>
                                                            <th>تاریخ خروج</th>
                                                            <th>ساعت خروج</th>
                                                            <th>شماره حواله خروجی</th>
                                                            <th>شماره بارنامه</th>
                                                            <th>شماره پلاک ماشین</th>
                                                            <th>شماره تلفن راننده</th>
                                                            <th>نام و نام خانوادگی راننده</th>
                                                            @if (isEditable)
                                                            {
                                                                <th>عملیات</th>
                                                            }
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @if (Model?.VehicleExit != null && Model.VehicleExit.Any())
                                                        {
                                                            foreach (var exit in Model.VehicleExit)
                                                            {
                                                                <tr>
                                                                    <td>@exit.S_persiandate_var</td>
                                                                    <td>@exit.ExitTime</td>
                                                                    <td>@exit.Shomareh_havale_khoruji</td>
                                                                    <td>@exit.Shomareh_barnameh</td>
                                                                    <td>@exit.Shomareh_plak</td>
                                                                    <td>@exit.Phone_ranandeh</td>
                                                                    <td>@exit.Name_ranandeh</td>
                                                                    @if (isEditable)
                                                                    {
                                                                        <td><button type="button" class="btn btn-sm btn-danger" onclick="removeVehicleExit(this)">حذف</button></td>
                                                                    }
                                                                </tr>
                                                            }
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                            @if (isEditable)
                                            {
                                                <button type="button" class="btn btn-sm btn-success mt-2" onclick="addVehicleExit()">افزودن خروج خودرو</button>
                                            }
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group col-md-12">
                                            <label asp-for="Tozihat_Entezamat" class="font-weight-bold">توضیحات انتظامات</label>
                                            <textarea asp-for="Tozihat_Entezamat" class="form-control" rows="5" disabled="@(!isEditable)"></textarea>
                                        </div>
                                    </div>
                                }
                                @if (sectionCode == "End3")
                                {
                                    <div class="form-row">
                                        <div class="form-group col-md-12">
                                            <p class="text-center">فرآیند پایان یافته است. اطلاعات بالا برای مرور در دسترس است.</p>
                                        </div>
                                    </div>
                                }
                                @if (isEditable && sectionCode != "End3")
                                {
                                    <div class="text-center mt-4">
                                        <button type="submit" class="btn btn-primary btn-lg">ثبت</button>
                                    </div>
                                }
                                <div id="message_@sectionCode" class="mt-3 text-center"></div>
                            </div>
                        </form>
                    </div>
                }
            }
        </div>
    </div>
</div>

<a onclick='openHistoryModal()'
   class="floating-help-left2">
    سوابق <i class="icon-spaced"></i>
</a>
<a href="javascript:void(0)" onclick="goBackAndRefresh()"
   class="floating-help-left">
    بازگشت <i class="fa fa-arrow-left icon-spaced"></i>
</a>
<div class="modal fade" id="AttachModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">سوابق</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-striped table-hover" id="historyTable">
                        <thead class="table-danger">
                            <tr>
                                <th scope="col">فرستنده</th>
                                <th scope="col">گیرنده</th>
                                <th scope="col">عنوان</th>
                                <th scope="col">تاریخ ارسال</th>
                                <th scope="col">تاریخ مشاهده</th>
                            </tr>
                        </thead>
                        <tbody id="tableFile2"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="close">بستن</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script src="~/jalalidatepicker/jalalidatepicker.min.js"></script>
    <script src="~/Parsley/parsley.min.js"></script>
    <script src="~/select 2/select 2.js"></script>
    <script>
        jalaliDatepicker.startWatch();
    </script>
    <script>
        function onUpload(e) {
            e.data = {
                guid: $("#Guid").val()
            };
        }
        function onRemove(e) {
            e.data = {
                guid: $("#Guid").val()
            };
        }
    </script>
    <script>
        let vehicleExitIndex = 0;

        function addVehicleExit() {
            const table = document.getElementById('vehicleExitsTable').getElementsByTagName('tbody')[0];
            const row = table.insertRow();
            row.innerHTML = `
                <td><input type="text" name="VehicleExits[${vehicleExitIndex}].S_persiandate_var" class="form-control" data-jdp /></td>
                <td><input type="text" name="VehicleExits[${vehicleExitIndex}].ExitTime" class="form-control" data-jdp data-jdp-only-time /></td>
                <td><input type="text" name="VehicleExits[${vehicleExitIndex}].Shomareh_havale_khoruji" class="form-control" /></td>
                <td><input type="text" name="VehicleExits[${vehicleExitIndex}].Shomareh_barnameh" class="form-control" /></td>
                <td><input type="text" name="VehicleExits[${vehicleExitIndex}].Shomareh_plak" class="form-control" /></td>
                <td><input type="text" name="VehicleExits[${vehicleExitIndex}].Phone_ranandeh" class="form-control" /></td>
                <td><input type="text" name="VehicleExits[${vehicleExitIndex}].Name_ranandeh" class="form-control" /></td>
                <td><button type="button" class="btn btn-danger" onclick="this.closest('tr').remove()">حذف</button></td>
            `;
            jalaliDatepicker.startWatch();
            vehicleExitIndex++;
        }

        function removeVehicleExit(button) {
            button.closest('tr').remove();
        }

        @foreach (var step in workflowSteps)
        {
            var sectionCode = step.SectionCode;
            <text>
                    $('#form_@sectionCode').on('submit', function (e) {
                        e.preventDefault();
                        if ($(this).parsley().validate()) {
                            let $btn = $(this).find('[type=submit]');
                            $btn.prop('disabled', true).text('در حال ارسال...');

                            const formData = {
                                GoodsDepartureID: $('#GoodsDepartureID').val(),
                                @if (sectionCode == "start0")
                                {
                                    @:S_persiandate: $('#S_persiandate').val(),
                                    @:Shomareh_Anabr: $('#Shomareh_Anabr').val(),
                                    @:Name_Anbar: $('#Name_Anbar').val(),
                                    @:Shomareh_havale: $('#Shomareh_havale').val(),
                                    @:Date_persiandate: $('#Date_persiandate').val(),
                                    @:Code_TahvilGirandeh: $('#Code_TahvilGirandeh').val(),
                                    @:Nam_TahvilGirandeh: $('#Nam_TahvilGirandeh').val(),
                                    @:Tozihat: $('#Tozihat').val(),
                                    @:FinanceUserID: $('#FinanceUserID').val(),
                                }
                                @if (sectionCode == "TayidMali1")
                                {
                                    @:Taeed: $('input[name="Taeed"]:checked').val(),
                                    @:Tozihat_Mali: $('#Tozihat_Mali').val(),
                                }
                                @if (sectionCode == "Negahbani2")
                                {
                                    @:IsBazrasi: $('input[name="IsBazrasi"]:checked').val(),
                                    @:Noe_Hamel: $('#Noe_Hamel').val(),
                                    @:VehicleExit: [],
                                    @:Tozihat_Entezamat: $('#Tozihat_Entezamat').val(),
                                }
                                Guid: $('#Guid').val()
                            };

                            @if (sectionCode == "Negahbani2")
                            {
                                <text>
                                        $('#vehicleExitsTable tbody tr').each(function () {
                                            const exit = {
                                                S_persiandate_var: $(this).find('input[name$=".S_persiandate_var"]').val(),
                                                ExitTime: $(this).find('input[name$=".ExitTime"]').val(),
                                                Shomareh_havale_khoruji: $(this).find('input[name$=".Shomareh_havale_khoruji"]').val(),
                                                Shomareh_barnameh: $(this).find('input[name$=".Shomareh_barnameh"]').val(),
                                                Shomareh_plak: $(this).find('input[name$=".Shomareh_plak"]').val(),
                                                Phone_ranandeh: $(this).find('input[name$=".Phone_ranandeh"]').val(),
                                                Name_ranandeh: $(this).find('input[name$=".Name_ranandeh"]').val()
                                            };
                                            if (exit.S_persiandate_var || exit.ExitTime || exit.Shomareh_havale_khoruji || exit.Shomareh_barnameh || exit.Shomareh_plak || exit.Phone_ranandeh || exit.Name_ranandeh) {
                                                formData.VehicleExit.push(exit);
                                            }
                                        });

                                        if (formData.VehicleExit.length === 0) {
                                            $('#message_@sectionCode').text('لطفاً حداقل یک ردیف برای خروج وسیله نقلیه وارد کنید.').removeClass().addClass('text-danger');
                                            $btn.prop('disabled', false).text('ثبت');
                                            return;
                                        }
                                    </text>
                            }

                            $.ajax({
                                url: '/GoodsDeparture/SaveForm@(sectionCode == "start0" ? "1" : sectionCode == "TayidMali1" ? "2" : "3")',
                                type: 'POST',
                                contentType: 'application/json',
                                data: JSON.stringify(formData),
                                success: function (response) {
                                    if (response.success === false) {
                                        $('#message_@sectionCode').text(response.message).removeClass().addClass('text-danger');
                                        $btn.prop('disabled', false).text('ثبت');
                                        return;
                                    }
                                    window.location.href = '@Url.Action("Index", "GoodsDeparture")';
                                },
                                error: function () {
                                    $('#message_@sectionCode').text('خطا در ارتباط با سرور.').removeClass().addClass('text-danger');
                                    $btn.prop('disabled', false).text('ثبت');
                                }
                            });
                        }
                    });
                </text>
        }

        document.addEventListener('DOMContentLoaded', function () {
            if ('@currentState' === 'Negahbani2') {
                addVehicleExit();
            }
        });

        function openHistoryModal() {
            var Guid = $("#Guid").val();
            $.ajax({
                type: "POST",
                url: "/GoodsDeparture/History",
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                data: { Guid: Guid },
                success: function (response) {
                    if (response.status === 'OK') {
                        $('#tableFile2').empty();
                        if (response.data.length > 0) {
                            $.each(response.data, function (i, item) {
                                var markup = `<tr>
                                    <td>${item.SenderID}</td>
                                    <td>${item.ReceiverID}</td>
                                    <td>${item.Title}</td>
                                    <td>${item.SendDateTime}</td>
                                    <td>${item.ViewDateTime}</td>
                                </tr>`;
                                $("#tableFile2").append(markup);
                            });
                            $("#historyTable").show();
                        } else {
                            $("#tableFile2").append('<tr><td colspan="6" class="text-center">هیچ رکوردی یافت نشد</td></tr>');
                            $("#historyTable").show();
                        }
                    }
                    $("#AttachModal").modal('show');
                },
                error: function (xhr, status, error) {
                    alert('خطا در ارتباط با سرور: ' + error);
                }
            });
        }
    </script>
    <script>
             $(document).ready(function () {
            $.ajax({
                url: '/GoodsDeparture/GetFinanceUser',
                method: 'GET',
                dataType: 'json',
                success: function (data) {
                    var $dropdown = $('#FinanceUserID');
                    $dropdown.empty();
                    $dropdown.append($('<option>', {
                        value: '',
                        text: 'یک شخص را انتخاب کنید'
                    }));

                    // افزودن کاربران
                    $.each(data, function (index, user) {
                        $dropdown.append($('<option>', {
                            value: user.id,
                            text: user.text
                        }));
                    });

                    // راه‌اندازی Select2
                    $dropdown.select2({
                        placeholder: "انتخاب فرد تایید کننده",
                        allowClear: true,
                        dir: "rtl"
                    });
                },
                error: function (xhr, status, error) {
                    console.log("Error:", status, error); // برای دیباگ
                    console.log("Response:", xhr.responseText); // متن پاسخ سرور
                    alert('خطا در دریافت لیست کاربران: ' + error);
                }
            });
        });
    </script>
}

@section styles {
    <link href="~/jalalidatepicker/jalalidatepicker.css" rel="stylesheet" />
    <link href="~/Parsley/parsley.css" rel="stylesheet" />
    <link href="~/select 2/select 2.css" rel="stylesheet" />
    <style>
        body {
            background-color: #f8f9fa;
        }

        .form-control {
            border: 2px solid black;
        }

        .table-bordered th, .table-bordered td {
            border: 1px solid #dee2e6;
        }

        input.sq[type="radio"][disabled] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

            input.sq[type="radio"][disabled] + label.sq {
                position: relative;
                padding-left: 25px;
                cursor: not-allowed;
                user-select: none;
                line-height: 20px;
                display: inline-block;
                color: black;
            }

                input.sq[type="radio"][disabled] + label.sq::before {
                    content: "";
                    position: absolute;
                    left: 0;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 18px;
                    height: 18px;
                    border: 2px solid #aaa;
                    border-radius: 3px;
                    background: #f5f5f5;
                    box-sizing: border-box;
                }

            input.sq[type="radio"][disabled]:checked + label.sq::before {
                background-color: white;
                border-color: black;
                content: "✓";
                color: black;
                font-weight: bold;
                font-size: 15px;
                text-align: center;
                line-height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }


        .select2-container .select2-selection--single {
            height: 40px !important;
            line-height: 40px !important;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 40px !important;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 38px !important;
        }

        .HideTable {
            display: none !important;
        }

        .ShowTable {
            display: inline-table !important;
        }

        .floating-help-left {
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            background: linear-gradient(45deg, #d32f2f, #b71c1c);
            color: #fff;
            padding: 10px 16px;
            border-top-right-radius: 25px;
            border-bottom-right-radius: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 14px;
            font-weight: bold;
            z-index: 9999;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

            .floating-help-left:hover {
                background: linear-gradient(45deg, #c62828, #8e0000);
                text-decoration: none;
                padding-left: 20px;
            }

        .floating-help-left2 {
            position: fixed;
            top: 40%; /* کمی بالاتر از وسط */
            left: 0;
            background: linear-gradient(45deg, #1976d2, #0d47a1);
            color: #fff !important;
            padding: 10px 16px;
            border-top-right-radius: 25px;
            border-bottom-right-radius: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 14px;
            font-weight: bold;
            z-index: 9999;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            margin-bottom: 10px; /* فاصله از دکمه بعدی */
            cursor: pointer;
        }

            .floating-help-left2:hover {
                background: linear-gradient(45deg, #1565c0, #002171) text-decoration: none;
                padding-left: 20px;
            }

        .icon-spaced {
            margin-right: 10px;
        }

        .modal-xl {
            max-width: 70%;
        }

        .id-card {
            padding: 6px 14px;
            background: #ffffff;
            border: 2px solid #dc3545;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
            margin-right: 10px;
            box-shadow: 0 0 6px rgba(220,53,69,0.3);
        }
    </style>
}